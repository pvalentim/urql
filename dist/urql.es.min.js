import{make as r,subscribe as t,onEnd as e,onPush as n,toPromise as o,take as i,share as u,filter as a,map as c,tap as s,merge as f,mergeMap as p,takeUntil as v,switchMap as l,fromValue as h,interval as d,makeSubject as y,onStart as m}from"wonka";import{GraphQLError as x,parse as g,print as O,visit as w,Kind as k}from"graphql";import{createContext as q,useContext as b,useRef as E,useState as N,useCallback as S,useLayoutEffect as P,useEffect as _,useMemo as j}from"react";function A(){return(A=Object.assign||function(r){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n])}return r}).apply(this,arguments)}var Q=function(r,t){var e="";return void 0!==r?e="[Network] "+r.message:(void 0!==t&&t.forEach(function(r){e+="[GraphQL] "+r.message+"\n"}),e.trim())},C=function(r){return"string"==typeof r?new x(r):"object"==typeof r&&r.message?new x(r.message,r.nodes,r.source,r.positions,r.path,r.originalError,r.extensions||{}):r};function I(){return this.message}var R=function(r){function t(t){var e=t.networkError,n=t.response,o=(t.graphQLErrors||[]).map(C),i=Q(e,o);r.call(this,i),this.name="CombinedError",this.message=i,this.graphQLErrors=o,this.networkError=e,this.response=n}return r&&(t.__proto__=r),(t.prototype=Object.create(r&&r.prototype)).constructor=t,t.prototype.toString=I,t}(Error),L=function(r,t){r|=0;for(var e=0,n=0|t.length;e<n;e++)r=(r<<5)+r+t.charCodeAt(e);return r},F=new Set,M=function(r){if(void 0===r)return"";if("number"==typeof r)return isFinite(r)?""+r:"null";if("object"!=typeof r)return JSON.stringify(r);if(null===r)return"null";var t="";if(Array.isArray(r)){t="[";for(var e=0,n=r.length;e<n;e++){e>0&&(t+=",");var o=M(r[e]);t+=o.length>0?o:"null"}return t+"]"}if(F.has(r))throw new TypeError("Converting circular structure to JSON");var i=Object.keys(r).sort();F.add(r),t="{";for(var u=0,a=i.length;u<a;u++){var c=i[u],s=M(r[c]);0!==s.length&&(t.length>1&&(t+=","),t+=M(c)+":"+s)}return F.delete(r),t+"}"},D=function(r){return F.clear(),M(r)},T=function(r){return t=r.replace(/[\s,]+/g," ").trim(),L(5381,t)>>>0;var t},$=Object.create(null),J=function(r,t){var e,n;return"string"==typeof r?(e=T(r),n=void 0!==$[e]?$[e]:g(r)):void 0!==r.__key?(e=r.__key,n=r):(e=T(O(r)),n=void 0!==$[e]?$[e]:r),$[e]=n,n.__key=e,{key:t?L(e,D(t))>>>0:e,query:n,variables:t||{}}},G=function(r,t){return A({},r,{context:A({},r.context,{meta:A({},r.context.meta,t)})})},z=function(r,t,e){return{operation:r,data:t.data,error:Array.isArray(t.errors)?new R({graphQLErrors:t.errors,response:e}):void 0,extensions:"object"==typeof t.extensions&&null!==t.extensions?t.extensions:void 0}},B=function(r,t,e){return{operation:r,data:void 0,error:new R({networkError:t,response:e}),extensions:void 0}},H=function(r,t){if(void 0===t&&(t=[]),Array.isArray(r))r.forEach(function(r){H(r,t)});else if("object"==typeof r&&null!==r)for(var e in r)if(Object.prototype.hasOwnProperty.call(r,e)){var n=r[e];"__typename"===e&&"string"==typeof n?t.push(n):"object"==typeof n&&null!==n&&H(n,t)}return t};function K(r,t,e){return e.indexOf(r)===t}var U=function(r){return H(r).filter(K)};function V(r){return"Field"===r.kind&&"__typename"===r.name.value}var W=function(r){return void 0!==r.selectionSet&&(r.selectionSet.selections.some(V)?r:A({},r,{selectionSet:A({},r.selectionSet,{selections:r.selectionSet.selections.concat([{kind:k.FIELD,name:{kind:k.NAME,value:"__typename"}}])})}))},X=function(r){return w(r,{Field:W,InlineFragment:W})};function Y(r){return r.toPromise=function(){return o(i(1)(r))},r}var Z=function(){},rr=function(r){var t=r.operationName;return"subscription"!==t&&"query"!==t};function tr(r){return""+r}var er=function(r){var t=r.error,e={data:r.data,error:void 0};return void 0!==t&&(e.error={networkError:""+t.networkError,graphQLErrors:t.graphQLErrors.map(tr)}),e},nr=function(r,t){var e=t.error,n={operation:r,data:t.data,extensions:void 0,error:void 0};return void 0!==e&&(n.error=new R({networkError:new Error(e.networkError),graphQLErrors:e.graphQLErrors})),n},or=function(r){var t={},e=function(r){return!rr(r)&&void 0!==t[r.key]};function n(r){return!e(r)}function o(r){return nr(r,t[r.key])}function i(r){return e(r)}function p(r){var e=r.operation;if(!rr(e)){var n=er(r);t[e.key]=n}}function v(r){delete t[r.operation.key]}var l=function(t){var e=t.client,l=t.forward;return function(t){var h=r&&"boolean"==typeof r.isClient?!!r.isClient:!e.suspense,d=u(t),y=l(a(n)(d)),m=c(o)(a(i)(d));return h?m=s(v)(m):y=s(p)(y),f([y,m])}};return l.restoreData=function(r){return A(t,r)},l.extractData=function(){return A({},t)},r&&r.initialState&&l.restoreData(r.initialState),l},ir=function(r){var t=r.operationName;return"mutation"!==t&&"query"!==t};function ur(r){return A({},r,{query:X(r.query)})}function ar(r){return G(r,{cacheOutcome:"miss"})}function cr(r){return ir(r)}var sr=function(r){var t=r.forward,e=r.client,n=new Map,o=Object.create(null),i=ur,p=pr(n,o,e),v=vr(n,o),l=function(r){var t=r.context.requestPolicy;return"query"===r.operationName&&"network-only"!==t&&("cache-only"===t||n.has(r.key))};function h(r){var t=n.get(r.key);return"cache-and-network"===r.context.requestPolicy&&fr(e,r),A({},t,{operation:G(r,{cacheOutcome:t?"hit":"miss"})})}function d(r){return!ir(r)&&l(r)}function y(r){r.operation&&"mutation"===r.operation.operationName?p(r):r.operation&&"query"===r.operation.operationName&&v(r)}function m(r){return!ir(r)&&!l(r)}return function(r){var e=u(r),n=c(h)(a(d)(e)),o=s(y)(t(c(ar)(f([c(i)(a(m)(e)),a(cr)(e)]))));return f([n,o])}},fr=function(r,t){return r.reexecuteOperation(A({},t,{context:A({},t.context,{requestPolicy:"network-only"})}))},pr=function(r,t,e){function n(t){if(r.has(t)){var n=r.get(t).operation;r.delete(t),fr(e,n)}}return function(r){var e=new Set;function o(r){e.add(r)}U(r.data).forEach(function(r){var e=t[r]||(t[r]=new Set);e.forEach(o),e.clear()}),e.forEach(n)}},vr=function(r,t){return function(e){var n=e.operation,o=e.data;null!=o&&(r.set(n.key,{operation:n,data:o,error:e.error}),U(e.data).forEach(function(r){(t[r]||(t[r]=new Set)).add(n.key)}))}},lr=function(r){return"subscription"===r.operationName};function hr(r){return!lr(r)}var dr=function(t){var e=t.forwardSubscription;return function(t){var n=t.client,o=t.forward;return function(t){var i=u(t),c=p(function(t){var o=t.key,u=a(function(r){return"teardown"===r.operationName&&r.key===o})(i);return v(u)(function(t){var o=e({key:t.key.toString(36),query:O(t.query),variables:t.variables,context:A({},t.context)});return r(function(r){var e=r[0],i=r[1],u=!1,a=o.subscribe({next:function(r){return e(z(t,r))},error:function(r){return e(B(t,r))},complete:function(){u||n.reexecuteOperation(A({},t,{operationName:"teardown"})),i()}});return function(){u=!0,a.unsubscribe()}})}(t))})(a(lr)(i)),s=o(a(hr)(i));return f([c,s])}}},yr=function(r){var t=r.forward;return function(r){return t(r)}},mr=function(r){var t=r.forward,e=new Set,n=function(r){var t=r.key,n=r.operationName;if("teardown"===n)return e.delete(t),!0;if("query"!==n)return!0;var o=e.has(t);return e.add(t),!o},o=function(r){e.delete(r.operation.key)};return function(r){var e=a(n)(r);return s(o)(t(e))}};function xr(r){var t=r.operationName;return"query"===t||"mutation"===t}var gr=function(r){var t=r.forward,e=xr;function n(r){return!e(r)}return function(r){var o=u(r),i=p(function(r){var t=r.key,e=a(function(r){return"teardown"===r.operationName&&r.key===t})(o);return v(e)(wr(r))})(a(e)(o)),c=t(a(n)(o));return f([i,c])}};function Or(r){return r.kind===k.OPERATION_DEFINITION&&r.name}var wr=function(t){return r(function(r){var e,n=r[0],o=r[1],i="undefined"!=typeof AbortController?new AbortController:void 0,u=t.context,a="function"==typeof u.fetchOptions?u.fetchOptions():u.fetchOptions||{},c=void 0!==(e=t.query.definitions.find(Or))&&e.name?e.name.value:null,s={query:O(t.query),variables:t.variables};null!==c&&(s.operationName=c);var f=A({body:JSON.stringify(s),method:"POST"},a,{headers:A({"content-type":"application/json"},a.headers),signal:void 0!==i?i.signal:void 0});return kr(t,f).then(function(r){void 0!==r&&n(r),o()}),function(){void 0!==i&&i.abort()}})},kr=function(r,t){var e,n=r.context;return(n.fetch||fetch)(n.url,t).then(function(r){var n=r.status;if(e=r,n<200||n>=("manual"===t.redirect?400:300))throw new Error(r.statusText);return r.json()}).then(function(t){return z(r,t,e)}).catch(function(t){if("AbortError"!==t.name)return B(r,t,e)})};function qr(){return!1}function br(r){}var Er=function(r){return a(qr)(s(br)(r))},Nr=function(r){return 1===r.length?r[0]:function(t){var e=t.client;return r.reduceRight(function(r,t){return t({client:e,forward:r})},t.forward)}},Sr=[mr,sr,gr],Pr=function(r){return new _r(r)},_r=function(r){var t=this;this.activeOperations=Object.create(null),this.createOperationContext=function(r){var e=(r||{}).requestPolicy;return void 0===e&&(e=t.requestPolicy),A({url:t.url,fetchOptions:t.fetchOptions,fetch:t.fetch},r,{requestPolicy:e})},this.createRequestOperation=function(r,e,n){return{key:e.key,query:e.query,variables:e.variables,operationName:r,context:t.createOperationContext(n)}},this.reexecuteOperation=function(r){(t.activeOperations[r.key]||0)>0&&t.dispatchOperation(r)},this.executeQuery=function(r,e){var n=t.createRequestOperation("query",r,e),o=t.executeRequestOperation(n),i=n.context.pollInterval;return i?l(function(){return o})(f([h(0),d(i)])):o},this.executeSubscription=function(r,e){var n=t.createRequestOperation("subscription",r,e);return t.executeRequestOperation(n)},this.executeMutation=function(r,e){var n=t.createRequestOperation("mutation",r,e);return t.executeRequestOperation(n)},this.url=r.url,this.fetchOptions=r.fetchOptions,this.fetch=r.fetch,this.suspense=!!r.suspense,this.requestPolicy=r.requestPolicy||"cache-first";var e=y(),n=e[1];this.operations$=e[0];var o=[],i=!1;this.dispatchOperation=function(r){if(o.push(r),!i){var t;for(i=!0;void 0!==(t=o.shift());)n(t);i=!1}},this.exchange=Nr(void 0!==r.exchanges?r.exchanges:Sr),this.results$=u(this.exchange({client:this,forward:Er})(this.operations$))};_r.prototype.onOperationStart=function(r){var t=r.key;this.activeOperations[t]=(this.activeOperations[t]||0)+1,this.dispatchOperation(r)},_r.prototype.onOperationEnd=function(r){var t=r.key,e=this.activeOperations[t]||0;(this.activeOperations[t]=e<=0?0:e-1)<=0&&this.dispatchOperation(A({},r,{operationName:"teardown"}))},_r.prototype.executeRequestOperation=function(o){var u=this,c=o.key,s=o.operationName,f=a(function(r){return r.operation.key===c})(this.results$);if("mutation"===s)return i(1)(m(function(){return u.dispatchOperation(o)})(f));var p,l=a(function(r){return"teardown"===r.operationName&&r.key===c})(this.operations$),h=e(function(){return u.onOperationEnd(o)})(m(function(){return u.onOperationStart(o)})(v(l)(f)));return(o.context.suspense||this.suspense)&&"query"===s?(p=h,r(function(r){var o,i,u=r[0],a=r[1],c=!1,s=t(function(r){void 0===o?i=r:c||(o(r),a(),s())})(e(a)(n(u)(p)))[0];if(void 0===i)throw new Promise(function(r){o=r});return function(){c=!0,s()}})):h},_r.prototype.query=function(r,t,e){return e&&"boolean"==typeof e.suspense||(e=A({},e,{suspense:!1})),Y(this.executeQuery(J(r,t),e))},_r.prototype.mutation=function(r,t,e){return Y(this.executeMutation(J(r,t),e))};var jr=q(Pr({url:"/graphql"})),Ar=jr.Provider,Qr=jr.Consumer,Cr=function(r){var t=b(jr);return r||t},Ir="undefined"!=typeof window?P:_,Rr=function(r){var t=E(!1),e=N(r),n=e[0],o=e[1],i=S(function(r){if(t.current)o(r);else{var e="function"==typeof r?r(n):r;A(n,e)}},[]);function u(){t.current=!1}return Ir(function(){return t.current=!0,u},[]),[n,i]},Lr=function(r,t){var e=Cr(t),n=Rr({fetching:!1,error:void 0,data:void 0,extensions:void 0}),i=n[1];function u(r){return i({fetching:!1,data:r.data,error:r.error,extensions:r.extensions}),r}return[n[0],S(function(t,n){i({fetching:!0,error:void 0,data:void 0,extensions:void 0});var a=J(r,t);return o(e.executeMutation(a,n||{})).then(u)},[e,r,i])]},Fr=function(r,t){var e=E(void 0);return j(function(){var n=J(r,t);return void 0!==e.current&&e.current.key===n.key?e.current:(e.current=n,n)},[r,t])},Mr=function(r,t){var e=E(Z),n=E(!1);n.current||(e.current(),e.current=r()||Z),_(function(){return n.current?r():(n.current=!0,e.current)},t)};function Dr(r){return A({},r,{fetching:!0})}function Tr(r){return A({},r,{fetching:!1})}function $r(r){return A({},r,{fetching:!1})}var Jr=function(r){var n=E(Z),o=Cr(r.client),i=Rr({fetching:!1,data:void 0,error:void 0,extensions:void 0}),u=i[0],a=i[1],c=Fr(r.query,r.variables);function s(r){a({fetching:!1,data:r.data,error:r.error,extensions:r.extensions})}function f(){return a(Tr)}var p=S(function(i){var u;n.current(),a(Dr),u=t(s)(e(f)(o.executeQuery(c,A({requestPolicy:r.requestPolicy,pollInterval:r.pollInterval},r.context,i)))),n.current=u[0]},[r.context,r.requestPolicy,r.pollInterval,o,c,a]);function v(){return n.current()}return Mr(function(){return r.pause?(n.current(),a($r),Z):(p(),v)},[p,r.pause,a]),[u,p]};function Gr(r){return A({},r,{fetching:!0})}function zr(r){return A({},r,{fetching:!1})}function Br(r){return A({},r,{fetching:!1})}var Hr=function(r,n){var o=E(Z),i=E(n),u=Cr(r.client),a=Rr({fetching:!1,error:void 0,data:void 0,extensions:void 0}),c=a[0],s=a[1];i.current=n;var f=Fr(r.query,r.variables);function p(r){var t=r.data,e=r.error,n=r.extensions,o=i.current;s(function(r){return{fetching:!0,data:"function"==typeof o?o(r.data,t):t,error:e,extensions:n}})}function v(){return s(zr)}var l=S(function(n){var i;o.current(),s(Gr),i=t(p)(e(v)(u.executeSubscription(f,A({},r.context,n)))),o.current=i[0]},[u,f,s,r.context]);function h(){return o.current()}return Mr(function(){return r.pause?(o.current(),s(Br),Z):(l(),h)},[l,r.pause,s]),[c,l]};function Kr(r){var t=r.children,e=Lr(r.query);return t(A({},e[0],{executeMutation:e[1]}))}function Ur(r){var t=Jr(r);return r.children(A({},t[0],{executeQuery:t[1]}))}function Vr(r){var t=Hr(r,r.handler);return r.children(A({},t[0],{executeSubscription:t[1]}))}export{_r as Client,R as CombinedError,Qr as Consumer,jr as Context,Kr as Mutation,Ar as Provider,Ur as Query,Vr as Subscription,sr as cacheExchange,Nr as composeExchanges,Pr as createClient,J as createRequest,yr as debugExchange,mr as dedupExchange,Sr as defaultExchanges,Er as fallbackExchangeIO,gr as fetchExchange,X as formatDocument,B as makeErrorResult,z as makeResult,or as ssrExchange,D as stringifyVariables,dr as subscriptionExchange,Cr as useClient,Lr as useMutation,Jr as useQuery,Hr as useSubscription};
