"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("wonka"),r=require("graphql"),t=require("react");function n(){return(n=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}var o=function(e,r){var t="";return void 0!==e?t="[Network] "+e.message:(void 0!==r&&r.forEach(function(e){t+="[GraphQL] "+e.message+"\n"}),t.trim())},i=function(e){return"string"==typeof e?new r.GraphQLError(e):"object"==typeof e&&e.message?new r.GraphQLError(e.message,e.nodes,e.source,e.positions,e.path,e.originalError,e.extensions||{}):e};function u(){return this.message}var a=function(e){function r(r){var t=r.networkError,n=r.response,u=(r.graphQLErrors||[]).map(i),a=o(t,u);e.call(this,a),this.name="CombinedError",this.message=a,this.graphQLErrors=u,this.networkError=t,this.response=n}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.toString=u,r}(Error),c=function(e,r){e|=0;for(var t=0,n=0|r.length;t<n;t++)e=(e<<5)+e+r.charCodeAt(t);return e},s=new Set,f=function(e){if(void 0===e)return"";if("number"==typeof e)return isFinite(e)?""+e:"null";if("object"!=typeof e)return JSON.stringify(e);if(null===e)return"null";var r="";if(Array.isArray(e)){r="[";for(var t=0,n=e.length;t<n;t++){t>0&&(r+=",");var o=f(e[t]);r+=o.length>0?o:"null"}return r+"]"}if(s.has(e))throw new TypeError("Converting circular structure to JSON");var i=Object.keys(e).sort();s.add(e),r="{";for(var u=0,a=i.length;u<a;u++){var c=i[u],p=f(e[c]);0!==p.length&&(r.length>1&&(r+=","),r+=f(c)+":"+p)}return s.delete(e),r+"}"},p=function(e){return s.clear(),f(e)},l=function(e){return r=e.replace(/[\s,]+/g," ").trim(),c(5381,r)>>>0;var r},v=Object.create(null),h=function(e,t){var n,o;return"string"==typeof e?(n=l(e),o=void 0!==v[n]?v[n]:r.parse(e)):void 0!==e.__key?(n=e.__key,o=e):(n=l(r.print(e)),o=void 0!==v[n]?v[n]:e),v[n]=o,o.__key=n,{key:t?c(n,p(t))>>>0:n,query:o,variables:t||{}}},d=function(e,r){return n({},e,{context:n({},e.context,{meta:n({},e.context.meta,r)})})},y=function(e,r,t){return{operation:e,data:r.data,error:Array.isArray(r.errors)?new a({graphQLErrors:r.errors,response:t}):void 0,extensions:"object"==typeof r.extensions&&null!==r.extensions?r.extensions:void 0}},x=function(e,r,t){return{operation:e,data:void 0,error:new a({networkError:r,response:t}),extensions:void 0}},m=function(e,r){if(void 0===r&&(r=[]),Array.isArray(e))e.forEach(function(e){m(e,r)});else if("object"==typeof e&&null!==e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=e[t];"__typename"===t&&"string"==typeof n?r.push(n):"object"==typeof n&&null!==n&&m(n,r)}return r};function g(e,r,t){return t.indexOf(e)===r}var k=function(e){return m(e).filter(g)};function b(e){return"Field"===e.kind&&"__typename"===e.name.value}var O=function(e){return void 0!==e.selectionSet&&(e.selectionSet.selections.some(b)?e:n({},e,{selectionSet:n({},e.selectionSet,{selections:e.selectionSet.selections.concat([{kind:r.Kind.FIELD,name:{kind:r.Kind.NAME,value:"__typename"}}])})}))},w=function(e){return r.visit(e,{Field:O,InlineFragment:O})};function E(r){return r.toPromise=function(){return e.toPromise(e.take(1)(r))},r}var q=function(){},S=function(e){var r=e.operationName;return"subscription"!==r&&"query"!==r};function N(e){return""+e}var P=function(e){var r=e.error,t={data:e.data,error:void 0};return void 0!==r&&(t.error={networkError:""+r.networkError,graphQLErrors:r.graphQLErrors.map(N)}),t},C=function(e,r){var t=r.error,n={operation:e,data:r.data,extensions:void 0,error:void 0};return void 0!==t&&(n.error=new a({networkError:new Error(t.networkError),graphQLErrors:t.graphQLErrors})),n},R=function(e){var r=e.operationName;return"mutation"!==r&&"query"!==r};function _(e){return n({},e,{query:w(e.query)})}function j(e){return d(e,{cacheOutcome:"miss"})}function Q(e){return R(e)}var M=function(r){var t=r.forward,o=r.client,i=new Map,u=Object.create(null),a=_,c=L(i,u,o),s=I(i,u),f=function(e){var r=e.context.requestPolicy;return"query"===e.operationName&&"network-only"!==r&&("cache-only"===r||i.has(e.key))};function p(e){var r=i.get(e.key);return"cache-and-network"===e.context.requestPolicy&&A(o,e),n({},r,{operation:d(e,{cacheOutcome:r?"hit":"miss"})})}function l(e){return!R(e)&&f(e)}function v(e){e.operation&&"mutation"===e.operation.operationName?c(e):e.operation&&"query"===e.operation.operationName&&s(e)}function h(e){return!R(e)&&!f(e)}return function(r){var n=e.share(r),o=e.map(p)(e.filter(l)(n)),i=e.tap(v)(t(e.map(j)(e.merge([e.map(a)(e.filter(h)(n)),e.filter(Q)(n)]))));return e.merge([o,i])}},A=function(e,r){return e.reexecuteOperation(n({},r,{context:n({},r.context,{requestPolicy:"network-only"})}))},L=function(e,r,t){function n(r){if(e.has(r)){var n=e.get(r).operation;e.delete(r),A(t,n)}}return function(e){var t=new Set;function o(e){t.add(e)}k(e.data).forEach(function(e){var t=r[e]||(r[e]=new Set);t.forEach(o),t.clear()}),t.forEach(n)}},I=function(e,r){return function(t){var n=t.operation,o=t.data;null!=o&&(e.set(n.key,{operation:n,data:o,error:t.error}),k(t.data).forEach(function(e){(r[e]||(r[e]=new Set)).add(n.key)}))}},D=function(e){return"subscription"===e.operationName};function F(e){return!D(e)}var T=function(r){var t=r.forward,n=new Set,o=function(e){var r=e.key,t=e.operationName;if("teardown"===t)return n.delete(r),!0;if("query"!==t)return!0;var o=n.has(r);return n.add(r),!o},i=function(e){n.delete(e.operation.key)};return function(r){var n=e.filter(o)(r);return e.tap(i)(t(n))}};function $(e){var r=e.operationName;return"query"===r||"mutation"===r}var G=function(r){var t=r.forward,n=$;function o(e){return!n(e)}return function(r){var i=e.share(r),u=e.mergeMap(function(r){var t=r.key,n=e.filter(function(e){return"teardown"===e.operationName&&e.key===t})(i);return e.takeUntil(n)(K(r))})(e.filter(n)(i)),a=t(e.filter(o)(i));return e.merge([u,a])}};function J(e){return e.kind===r.Kind.OPERATION_DEFINITION&&e.name}var K=function(t){return e.make(function(e){var o,i=e[0],u=e[1],a="undefined"!=typeof AbortController?new AbortController:void 0,c=t.context,s="function"==typeof c.fetchOptions?c.fetchOptions():c.fetchOptions||{},f=void 0!==(o=t.query.definitions.find(J))&&o.name?o.name.value:null,p={query:r.print(t.query),variables:t.variables};null!==f&&(p.operationName=f);var l=n({body:JSON.stringify(p),method:"POST"},s,{headers:n({"content-type":"application/json"},s.headers),signal:void 0!==a?a.signal:void 0});return U(t,l).then(function(e){void 0!==e&&i(e),u()}),function(){void 0!==a&&a.abort()}})},U=function(e,r){var t,n=e.context;return(n.fetch||fetch)(n.url,r).then(function(e){var n=e.status;if(t=e,n<200||n>=("manual"===r.redirect?400:300))throw new Error(e.statusText);return e.json()}).then(function(r){return y(e,r,t)}).catch(function(r){if("AbortError"!==r.name)return x(e,r,t)})};function V(){return!1}function z(e){}var B=function(r){return e.filter(V)(e.tap(z)(r))},H=function(e){return 1===e.length?e[0]:function(r){var t=r.client;return e.reduceRight(function(e,r){return r({client:t,forward:e})},r.forward)}},W=[T,M,G],X=function(e){return new Y(e)},Y=function(r){var t=this;this.activeOperations=Object.create(null),this.createOperationContext=function(e){var r=(e||{}).requestPolicy;return void 0===r&&(r=t.requestPolicy),n({url:t.url,fetchOptions:t.fetchOptions,fetch:t.fetch},e,{requestPolicy:r})},this.createRequestOperation=function(e,r,n){return{key:r.key,query:r.query,variables:r.variables,operationName:e,context:t.createOperationContext(n)}},this.reexecuteOperation=function(e){(t.activeOperations[e.key]||0)>0&&t.dispatchOperation(e)},this.executeQuery=function(r,n){var o=t.createRequestOperation("query",r,n),i=t.executeRequestOperation(o),u=o.context.pollInterval;return u?e.switchMap(function(){return i})(e.merge([e.fromValue(0),e.interval(u)])):i},this.executeSubscription=function(e,r){var n=t.createRequestOperation("subscription",e,r);return t.executeRequestOperation(n)},this.executeMutation=function(e,r){var n=t.createRequestOperation("mutation",e,r);return t.executeRequestOperation(n)},this.url=r.url,this.fetchOptions=r.fetchOptions,this.fetch=r.fetch,this.suspense=!!r.suspense,this.requestPolicy=r.requestPolicy||"cache-first";var o=e.makeSubject(),i=o[1];this.operations$=o[0];var u=[],a=!1;this.dispatchOperation=function(e){if(u.push(e),!a){var r;for(a=!0;void 0!==(r=u.shift());)i(r);a=!1}},this.exchange=H(void 0!==r.exchanges?r.exchanges:W),this.results$=e.share(this.exchange({client:this,forward:B})(this.operations$))};Y.prototype.onOperationStart=function(e){var r=e.key;this.activeOperations[r]=(this.activeOperations[r]||0)+1,this.dispatchOperation(e)},Y.prototype.onOperationEnd=function(e){var r=e.key,t=this.activeOperations[r]||0;(this.activeOperations[r]=t<=0?0:t-1)<=0&&this.dispatchOperation(n({},e,{operationName:"teardown"}))},Y.prototype.executeRequestOperation=function(r){var t=this,n=r.key,o=r.operationName,i=e.filter(function(e){return e.operation.key===n})(this.results$);if("mutation"===o)return e.take(1)(e.onStart(function(){return t.dispatchOperation(r)})(i));var u,a=e.filter(function(e){return"teardown"===e.operationName&&e.key===n})(this.operations$),c=e.onEnd(function(){return t.onOperationEnd(r)})(e.onStart(function(){return t.onOperationStart(r)})(e.takeUntil(a)(i)));return(r.context.suspense||this.suspense)&&"query"===o?(u=c,e.make(function(r){var t,n,o=r[0],i=r[1],a=!1,c=e.subscribe(function(e){void 0===t?n=e:a||(t(e),i(),c())})(e.onEnd(i)(e.onPush(o)(u)))[0];if(void 0===n)throw new Promise(function(e){t=e});return function(){a=!0,c()}})):c},Y.prototype.query=function(e,r,t){return t&&"boolean"==typeof t.suspense||(t=n({},t,{suspense:!1})),E(this.executeQuery(h(e,r),t))},Y.prototype.mutation=function(e,r,t){return E(this.executeMutation(h(e,r),t))};var Z=X({url:"/graphql"}),ee=t.createContext(Z),re=ee.Provider,te=ee.Consumer,ne=function(e){var r=t.useContext(ee);return e||r},oe="undefined"!=typeof window?t.useLayoutEffect:t.useEffect,ie=function(e){var r=t.useRef(!1),o=t.useState(e),i=o[0],u=o[1],a=t.useCallback(function(e){if(r.current)u(e);else{var t="function"==typeof e?e(i):e;n(i,t)}},[]);function c(){r.current=!1}return oe(function(){return r.current=!0,c},[]),[i,a]},ue=function(r,n){var o=ne(n),i=ie({fetching:!1,error:void 0,data:void 0,extensions:void 0}),u=i[1];function a(e){return u({fetching:!1,data:e.data,error:e.error,extensions:e.extensions}),e}return[i[0],t.useCallback(function(t,n){u({fetching:!0,error:void 0,data:void 0,extensions:void 0});var i=h(r,t);return e.toPromise(o.executeMutation(i,n||{})).then(a)},[o,r,u])]},ae=function(e,r){var n=t.useRef(void 0);return t.useMemo(function(){var t=h(e,r);return void 0!==n.current&&n.current.key===t.key?n.current:(n.current=t,t)},[e,r])},ce=function(e,r){var n=t.useRef(q),o=t.useRef(!1);o.current||(n.current(),n.current=e()||q),t.useEffect(function(){return o.current?e():(o.current=!0,n.current)},r)};function se(e){return n({},e,{fetching:!0})}function fe(e){return n({},e,{fetching:!1})}function pe(e){return n({},e,{fetching:!1})}var le=function(r){var o=t.useRef(q),i=ne(r.client),u=ie({fetching:!1,data:void 0,error:void 0,extensions:void 0}),a=u[0],c=u[1],s=ae(r.query,r.variables);function f(e){c({fetching:!1,data:e.data,error:e.error,extensions:e.extensions})}function p(){return c(fe)}var l=t.useCallback(function(t){var u;o.current(),c(se),u=e.subscribe(f)(e.onEnd(p)(i.executeQuery(s,n({requestPolicy:r.requestPolicy,pollInterval:r.pollInterval},r.context,t)))),o.current=u[0]},[r.context,r.requestPolicy,r.pollInterval,i,s,c]);function v(){return o.current()}return ce(function(){return r.pause?(o.current(),c(pe),q):(l(),v)},[l,r.pause,c]),[a,l]};function ve(e){return n({},e,{fetching:!0})}function he(e){return n({},e,{fetching:!1})}function de(e){return n({},e,{fetching:!1})}var ye=function(r,o){var i=t.useRef(q),u=t.useRef(o),a=ne(r.client),c=ie({fetching:!1,error:void 0,data:void 0,extensions:void 0}),s=c[0],f=c[1];u.current=o;var p=ae(r.query,r.variables);function l(e){var r=e.data,t=e.error,n=e.extensions,o=u.current;f(function(e){return{fetching:!0,data:"function"==typeof o?o(e.data,r):r,error:t,extensions:n}})}function v(){return f(he)}var h=t.useCallback(function(t){var o;i.current(),f(ve),o=e.subscribe(l)(e.onEnd(v)(a.executeSubscription(p,n({},r.context,t)))),i.current=o[0]},[a,p,f,r.context]);function d(){return i.current()}return ce(function(){return r.pause?(i.current(),f(de),q):(h(),d)},[h,r.pause,f]),[s,h]};exports.Client=Y,exports.CombinedError=a,exports.Consumer=te,exports.Context=ee,exports.Mutation=function(e){var r=e.children,t=ue(e.query);return r(n({},t[0],{executeMutation:t[1]}))},exports.Provider=re,exports.Query=function(e){var r=le(e);return e.children(n({},r[0],{executeQuery:r[1]}))},exports.Subscription=function(e){var r=ye(e,e.handler);return e.children(n({},r[0],{executeSubscription:r[1]}))},exports.cacheExchange=M,exports.composeExchanges=H,exports.createClient=X,exports.createRequest=h,exports.debugExchange=function(e){var r=e.forward;return function(e){return r(e)}},exports.dedupExchange=T,exports.defaultExchanges=W,exports.fallbackExchangeIO=B,exports.fetchExchange=G,exports.formatDocument=w,exports.makeErrorResult=x,exports.makeResult=y,exports.ssrExchange=function(r){var t={},o=function(e){return!S(e)&&void 0!==t[e.key]};function i(e){return!o(e)}function u(e){return C(e,t[e.key])}function a(e){return o(e)}function c(e){var r=e.operation;if(!S(r)){var n=P(e);t[r.key]=n}}function s(e){delete t[e.operation.key]}var f=function(t){var n=t.client,o=t.forward;return function(t){var f=r&&"boolean"==typeof r.isClient?!!r.isClient:!n.suspense,p=e.share(t),l=o(e.filter(i)(p)),v=e.map(u)(e.filter(a)(p));return f?v=e.tap(s)(v):l=e.tap(c)(l),e.merge([l,v])}};return f.restoreData=function(e){return n(t,e)},f.extractData=function(){return n({},t)},r&&r.initialState&&f.restoreData(r.initialState),f},exports.stringifyVariables=p,exports.subscriptionExchange=function(t){var o=t.forwardSubscription;return function(t){var i=t.client,u=t.forward;return function(t){var a=e.share(t),c=e.mergeMap(function(t){var u=t.key,c=e.filter(function(e){return"teardown"===e.operationName&&e.key===u})(a);return e.takeUntil(c)(function(t){var u=o({key:t.key.toString(36),query:r.print(t.query),variables:t.variables,context:n({},t.context)});return e.make(function(e){var r=e[0],o=e[1],a=!1,c=u.subscribe({next:function(e){return r(y(t,e))},error:function(e){return r(x(t,e))},complete:function(){a||i.reexecuteOperation(n({},t,{operationName:"teardown"})),o()}});return function(){a=!0,c.unsubscribe()}})}(t))})(e.filter(D)(a)),s=u(e.filter(F)(a));return e.merge([c,s])}}},exports.useClient=ne,exports.useMutation=ue,exports.useQuery=le,exports.useSubscription=ye;
